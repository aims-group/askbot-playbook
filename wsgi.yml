---
- hosts: all
  remote_user: root
  name: install askbot mog_wsgi configuration

  vars:
    app_wsgi_path: "{{ app_dir }}/wsgi.py"
    app_wsgi_conf_path: /etc/httpd/conf.d/{{ app_name }}.conf
    http_proxy: "wwwcache.rl.ac.uk:8080"
    https_proxy: "wwwcache.rl.ac.uk:8080"

  tasks:
    - name: install wsgi.py
      template: src=wsgi.py.j2 dest={{ app_wsgi_path }} owner=apache mode=0744
      notify: restart httpd
  
    - name: install apache wsgi.conf
      template: src=wsgi.conf.j2 dest={{ app_wsgi_conf_path }}
      notify: restart httpd
    
    - name: create logdir
      file: dest={{ log_dir }} owner=apache
      notify: restart httpd

  handlers:
    - name: restart httpd
      service: name=httpd state=restarted